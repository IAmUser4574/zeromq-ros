<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>ZeroMQ-ROS Middlware by wallarelvo</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>ZeroMQ-ROS Middlware</h1>
          <h2>ROS Wrapper Using ZeroMQ</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/wallarelvo/zeromq-ros/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/wallarelvo/zeromq-ros/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/wallarelvo/zeromq-ros" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a name="zeromq-ros" class="anchor" href="#zeromq-ros"><span class="octicon octicon-link"></span></a>ZeroMQ-ROS</h1>

<p>ZeroMQ-ROS is a middleware that allows for the control of multiple ROS masters from
a single coordinator and makes it easy to create swarm applications using the standard
ROS framework. ZeroMQ-ROS uses the ZeroMQ message queue to communicate between the coordinator
and the agents.</p>

<h2>
<a name="architecture" class="anchor" href="#architecture"><span class="octicon octicon-link"></span></a>Architecture</h2>

<h3>
<a name="agents" class="anchor" href="#agents"><span class="octicon octicon-link"></span></a>Agents</h3>

<p>Agents are members of the swarm that will be controlled by a coordinator. They are referenced by
a unique identifying name and listen for JSON serialized ROS messages on a message queue. These
serialized messages are then constructed into ROS messages and published to the associated topic.</p>

<h3>
<a name="coordinators" class="anchor" href="#coordinators"><span class="octicon octicon-link"></span></a>Coordinators</h3>

<p>Coordinators are the controllers of the swarm. They can send JSON serialized ROS messages to agents
that get published to the associated topic on the agent's ROS master. To enable bi-directional,
coordinators can also be agents and listen for messages.</p>

<h3>
<a name="naming-service" class="anchor" href="#naming-service"><span class="octicon octicon-link"></span></a>Naming service</h3>

<p>The naming service is used to associate a robot's unique name to a host and port of the ZeroMQ
message queue. This is vital for having dynamic swarm membership because instead of manually sharing
a configuration file, a persistent, centralized server runs that holds all of this information. Also,
the naming service holds a record of what agents are currently <em>alive</em> and able to be used.</p>

<h2>
<a name="install" class="anchor" href="#install"><span class="octicon octicon-link"></span></a>Install</h2>

<p><strong>[Warning] You must already have ROS installed on all machines you would like
to have in your swarm</strong></p>

<h3>
<a name="ubuntu" class="anchor" href="#ubuntu"><span class="octicon octicon-link"></span></a>Ubuntu</h3>

<pre><code>$ git clone https://github.com/wallarelvo/zeromq-ros.git
$ make
</code></pre>

<h3>
<a name="other-distributions" class="anchor" href="#other-distributions"><span class="octicon octicon-link"></span></a>Other distributions</h3>

<ol>
<li>Install Ubuntu</li>
<li>Follow instructions for installation on Ubuntu</li>
</ol><h2>
<a name="setting-up-the-middleware" class="anchor" href="#setting-up-the-middleware"><span class="octicon octicon-link"></span></a>Setting up the middleware</h2>

<h3>
<a name="environment-variables" class="anchor" href="#environment-variables"><span class="octicon octicon-link"></span></a>Environment Variables</h3>

<p>In order to use ZeroMQ-ROS, you must set a few environmental variables. These can
be set by exporting environmental variables in the terminal every time you start a
new terminal, or you can be sane and add them to your <code>.bashrc</code> or <code>.bash_profile</code>.
You must set variables described below. These environment variables need to be set on
every computer running ZeroMQ-ROS.</p>

<ul>
<li>
<code>ZMQROS_NS_HOST</code> -- Host of the naming service</li>
<li>
<code>ZMQROS_NS_PORT</code> -- Port of the naming service</li>
<li>
<code>ZMQROS_ROBOT_ID</code> -- A unique identifying name of the robot running ZeroMQ-ROS</li>
<li>
<code>ZMQROS_ROOT</code> -- The location of the root directory of the ZeroMQ-ROS installation</li>
</ul><h3>
<a name="database" class="anchor" href="#database"><span class="octicon octicon-link"></span></a>Database</h3>

<p>Wherever you choose to run the name server, you must also be running a RethinkDB database.
This database stores the names and identification numbers of the agents you wish the name
server to supervise. For instance, if you work in a robotics lab, the database
will contain all of the names of the robots in your lab along with some identification number.
All of the names in the database do not need to be used at the same time, they are just there
for reference by the name server.
These names need to be known a priori for more efficient swarm creation and name allocation.
To do this run</p>

<pre><code>$ rethinkdb --bind all
</code></pre>

<p>This will run the RethinkDB instance. In order to populate the database, run Zui, the
ZeroMQ-ROS UI running,</p>

<pre><code>$ zmqros --ui
</code></pre>

<p>Then to populate the database visit, <code>localhost:9000/add</code>. The website will ask you for the
robot names and an identification number. This is useful so that you can link the robot
to IP addresses, Vicon identification and so on.</p>

<h2>
<a name="running" class="anchor" href="#running"><span class="octicon octicon-link"></span></a>Running</h2>

<ol>
<li>First run the name server and populate the database with robot information. This step does 
not need to occur every time you run the swarm, however, the name server needs to be running for
agents and coordinators to communicate. The agents and the coordinators need to have their
environment variables pointing to the address and port the name server will be running from.

<ul>
<li><code>$ zmqros --ns</code></li>
</ul>
</li>
<li>On all of the agents in the swarm that are specified in the name server, run the agent code. 
This step also does not need to occur everytime the swarm is to be controlled, however to control an agent,
the agent program must be running.

<ul>
<li><code>$ zmqros --agent</code></li>
</ul>
</li>
<li>Run the coordinator code from where ever the coordinator is located.</li>
<li>(Optional) Now you are able to control the swarm. To look at properties in the swarm, run Zui, the web app for the
middleware. Using Zui, you will be able to look at the members of the swarm that are currently alive and
send ROS messages to them through a GUI.

<ul>
<li><code>$ zmqros --ui</code></li>
</ul>
</li>
</ol><h2>
<a name="coordinator-example" class="anchor" href="#coordinator-example"><span class="octicon octicon-link"></span></a>Coordinator example</h2>

<div class="highlight highlight-python"><pre><span class="kn">import</span> <span class="nn">zmqros</span>
<span class="kn">from</span> <span class="nn">zmqros.coordinator</span> <span class="kn">import</span> <span class="n">open_swarm</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">Twist</span>

<span class="n">ns_host</span> <span class="o">=</span> <span class="n">zmqros</span><span class="o">.</span><span class="n">get_ns_host</span><span class="p">()</span>
<span class="n">ns_port</span> <span class="o">=</span> <span class="n">zmqros</span><span class="o">.</span><span class="n">get_ns_port</span><span class="p">()</span>
<span class="n">nserver</span> <span class="o">=</span> <span class="n">zmqros</span><span class="o">.</span><span class="n">coordinator</span><span class="o">.</span><span class="n">NameServer</span><span class="p">(</span><span class="n">ns_host</span><span class="p">,</span> <span class="n">ns_port</span><span class="p">)</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">nserver</span><span class="o">.</span><span class="n">get_names</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">open_swarm</span><span class="p">(</span><span class="n">ns_host</span><span class="p">,</span> <span class="n">ns_port</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span> <span class="k">as</span> <span class="n">swarm</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">bot</span> <span class="ow">in</span> <span class="n">swarm</span><span class="o">.</span><span class="n">get_bots</span><span class="p">():</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">Twist</span><span class="p">()</span>
                <span class="n">t</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                <span class="n">t</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                <span class="n">t</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                <span class="n">t</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                <span class="n">t</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
                <span class="n">t</span><span class="o">.</span><span class="n">angular</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

                <span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="s">"geometry_msgs/Twist"</span><span class="p">,</span> <span class="s">"/cmd_vel"</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">run</span><span class="p">()</span>

</pre></div>
        </section>

        <footer>
          ZeroMQ-ROS Middlware is maintained by <a href="https://github.com/wallarelvo">wallarelvo</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>